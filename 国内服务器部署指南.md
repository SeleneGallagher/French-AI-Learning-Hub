# å›½å†…æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ç”±äºVercelæœåŠ¡å™¨åœ¨å›½å¤–ï¼Œå›½å†…è®¿é—®å¯èƒ½è¾ƒæ…¢æˆ–éœ€è¦VPNã€‚æœ¬æŒ‡å—å°†é¡¹ç›®éƒ¨ç½²åˆ°å›½å†…æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘ç­‰ï¼‰ï¼Œå®ç°å¿«é€Ÿè®¿é—®ã€‚

---

## ğŸ¯ éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆå¯¹æ¯”

| é¡¹ç›® | Vercel + Supabase | å›½å†…æœåŠ¡å™¨ |
|------|------------------|-----------|
| **å‰ç«¯** | Vercelé™æ€æ‰˜ç®¡ | Nginxé™æ€æ–‡ä»¶ |
| **åç«¯** | Serverless Functions | Flask/FastAPI |
| **æ•°æ®åº“** | Supabase PostgreSQL | Supabaseï¼ˆå¯è®¿é—®ï¼‰æˆ–MySQL/PostgreSQL |
| **è®¿é—®é€Ÿåº¦** | æ…¢ï¼ˆéœ€VPNï¼‰ | å¿«ï¼ˆå›½å†…æœåŠ¡å™¨ï¼‰ |
| **æˆæœ¬** | å…è´¹ï¼ˆæœ‰é™é¢ï¼‰ | çº¦50-200å…ƒ/æœˆ |

---

## ğŸ–¥ï¸ æœåŠ¡å™¨è¦æ±‚

### æœ€ä½é…ç½®
- **CPU**: 2æ ¸
- **å†…å­˜**: 2GB
- **å¸¦å®½**: 3Mbps
- **ç³»ç»Ÿ**: Ubuntu 22.04 LTSï¼ˆæ¨èï¼‰

### æ¨èé…ç½®
- **CPU**: 4æ ¸
- **å†…å­˜**: 4GB
- **å¸¦å®½**: 5Mbps
- **ç³»ç»Ÿ**: Ubuntu 22.04 LTS

---

## ğŸ“¦ éƒ¨ç½²æ­¥éª¤

### 1. å‡†å¤‡æœåŠ¡å™¨

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y git curl wget
```

### 2. å®‰è£…Pythonå’Œä¾èµ–

```bash
# å®‰è£…Python 3.10+
sudo apt install -y python3 python3-pip python3-venv

# å®‰è£…Nginx
sudo apt install -y nginx

# å®‰è£…PostgreSQLï¼ˆå¦‚æœä¸ç”¨Supabaseï¼‰
sudo apt install -y postgresql postgresql-contrib
```

### 3. å…‹éš†é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/french-ai
sudo chown $USER:$USER /var/www/french-ai

# å…‹éš†é¡¹ç›®
cd /var/www/french-ai
git clone https://github.com/SeleneGallagher/French-AI-Learning-Hub.git .

# æˆ–ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
# scp -r /path/to/AI_LL/* root@æœåŠ¡å™¨IP:/var/www/french-ai/
```

### 4. åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ

```bash
cd /var/www/french-ai
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install flask flask-cors gunicorn
```

### 5. åˆ›å»ºFlaskåç«¯åº”ç”¨

åˆ›å»º `app.py` æ–‡ä»¶ï¼ˆè§ä¸‹æ–¹ä»£ç ï¼‰

### 6. é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»º.envæ–‡ä»¶
nano .env
```

```env
# Supabaseé…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_SERVICE_KEY=ä½ çš„service_role_key
JWT_SECRET=ä½ çš„JWTå¯†é’¥ï¼ˆéšæœºå­—ç¬¦ä¸²ï¼‰

# å¯é€‰APIå¯†é’¥
COZE_BOT_ID=
COZE_ACCESS_TOKEN=
TMDB_API_KEY=
DEEPSEEK_API_KEY=
```

### 7. é…ç½®Nginx

```bash
sudo nano /etc/nginx/sites-available/french-ai
```

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸå.com;  # æˆ–æœåŠ¡å™¨IP

    # å‰ç«¯é™æ€æ–‡ä»¶
    root /var/www/french-ai;
    index index.html;

    # Gzipå‹ç¼©
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 7d;
        add_header Cache-Control "public, immutable";
    }

    # APIä»£ç†åˆ°åç«¯
    location /api/ {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # å‰ç«¯è·¯ç”±ï¼ˆSPAï¼‰
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

```bash
# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/french-ai /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### 8. é…ç½®SystemdæœåŠ¡

```bash
sudo nano /etc/systemd/system/french-ai.service
```

```ini
[Unit]
Description=French AI Learning Hub Backend
After=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/var/www/french-ai
Environment="PATH=/var/www/french-ai/venv/bin"
ExecStart=/var/www/french-ai/venv/bin/gunicorn --workers 3 --bind 127.0.0.1:5000 app:app
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable french-ai
sudo systemctl start french-ai

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status french-ai
```

### 9. é…ç½®SSLï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
# å®‰è£…Certbot
sudo apt install -y certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
sudo certbot --nginx -d ä½ çš„åŸŸå.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## ğŸ”§ ä»£ç ä¿®æ”¹

### 1. åˆ›å»ºFlaskåç«¯åº”ç”¨

åˆ›å»º `app.py`ï¼š

```python
from flask import Flask, request, jsonify
from flask_cors import CORS
import os
from dotenv import load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

app = Flask(__name__)
CORS(app)

# å¯¼å…¥APIè·¯ç”±
from api.auth.login import handler as login_handler
from api.auth.register import handler as register_handler
from api.news.list import handler as news_handler
from api.movies.list import handler as movies_handler
from api.dictionary.history import handler as dict_handler

@app.route('/api/auth/login', methods=['POST', 'OPTIONS'])
def login():
    return login_handler(request)

@app.route('/api/auth/register', methods=['POST', 'OPTIONS'])
def register():
    return register_handler(request)

@app.route('/api/news/list', methods=['GET', 'OPTIONS'])
def news_list():
    return news_handler(request)

@app.route('/api/movies/list', methods=['GET', 'OPTIONS'])
def movies_list():
    return movies_handler(request)

@app.route('/api/dictionary/history', methods=['GET', 'POST', 'OPTIONS'])
def dictionary_history():
    return dict_handler(request)

@app.route('/health', methods=['GET'])
def health():
    return jsonify({'status': 'ok'})

if __name__ == '__main__':
    app.run(host='127.0.0.1', port=5000, debug=False)
```

### 2. ä¿®æ”¹å‰ç«¯APIè°ƒç”¨

ä¿®æ”¹ `scripts/services/apiService.js`ï¼š

```javascript
// æ”¹ä¸ºä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆNginxä¼šä»£ç†åˆ°åç«¯ï¼‰
const API_BASE = '/api';
```

### 3. ä¿®æ”¹Vercel Serverless Functions

éœ€è¦å°† `api/**/*.py` ä¸­çš„å‡½æ•°æ”¹ä¸ºFlaskå…¼å®¹æ ¼å¼ï¼š

- å°† `handler(request)` æ”¹ä¸ºç›´æ¥å¤„ç†Flaskçš„ `request` å¯¹è±¡
- è¿”å›æ ¼å¼æ”¹ä¸ºFlaskçš„ `jsonify()` æˆ–ç›´æ¥è¿”å›å­—å…¸

---

## ğŸ“ ä¿®æ”¹APIå‡½æ•°ç¤ºä¾‹

### åŸVercelæ ¼å¼ï¼ˆapi/auth/login.pyï¼‰

```python
def handler(request):
    # ... å¤„ç†é€»è¾‘
    return json_response({'success': True, ...}, 200)
```

### Flaskæ ¼å¼

```python
def handler(request):
    # ... å¤„ç†é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰
    # è¿”å›Flaskæ ¼å¼
    from flask import jsonify
    return jsonify({'success': True, ...}), 200
```

æˆ–è€…åˆ›å»ºé€‚é…å™¨ï¼š

```python
# api/utils.py æ·»åŠ 
def flask_response(data, status_code=200):
    from flask import jsonify
    return jsonify(data), status_code

# åœ¨handlerä¸­ä½¿ç”¨
def handler(request):
    # ... é€»è¾‘
    return flask_response({'success': True, ...}, 200)
```

---

## ğŸ—„ï¸ æ•°æ®åº“é€‰æ‹©

### é€‰é¡¹1ï¼šç»§ç»­ä½¿ç”¨Supabaseï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- æ— éœ€è¿ç§»æ•°æ®
- ç®¡ç†æ–¹ä¾¿
- å…è´¹é¢åº¦å……è¶³

**ç¼ºç‚¹**ï¼š
- å›½å†…è®¿é—®å¯èƒ½è¾ƒæ…¢ï¼ˆä½†æœåŠ¡å™¨å¯ä»¥è®¿é—®ï¼‰

### é€‰é¡¹2ï¼šè¿ç§»åˆ°MySQL/PostgreSQL

**ä¼˜ç‚¹**ï¼š
- å®Œå…¨åœ¨å›½å†…
- è®¿é—®é€Ÿåº¦å¿«

**ç¼ºç‚¹**ï¼š
- éœ€è¦è¿ç§»æ•°æ®
- éœ€è¦è‡ªå·±ç®¡ç†æ•°æ®åº“

---

## ğŸ”„ æ•°æ®è¿ç§»ï¼ˆå¦‚æœé€‰æ‹©é€‰é¡¹2ï¼‰

### ä»Supabaseå¯¼å‡ºæ•°æ®

```sql
-- åœ¨Supabase SQL Editorä¸­æ‰§è¡Œ
COPY users TO STDOUT WITH CSV HEADER;
COPY registration_codes TO STDOUT WITH CSV HEADER;
-- ... å…¶ä»–è¡¨
```

### å¯¼å…¥åˆ°MySQL/PostgreSQL

```bash
# PostgreSQL
psql -U postgres -d french_ai -c "\COPY users FROM 'users.csv' WITH CSV HEADER"

# MySQL
mysqlimport --local -u root -p french_ai users.csv
```

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²è„šæœ¬

åˆ›å»º `deploy_china.sh`ï¼š

```bash
#!/bin/bash
# å›½å†…æœåŠ¡å™¨ä¸€é”®éƒ¨ç½²è„šæœ¬

set -e

echo "å¼€å§‹éƒ¨ç½²..."

# 1. å®‰è£…ä¾èµ–
sudo apt update
sudo apt install -y python3 python3-pip python3-venv nginx git

# 2. åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/french-ai
sudo chown $USER:$USER /var/www/french-ai

# 3. å…‹éš†é¡¹ç›®ï¼ˆæˆ–ä¸Šä¼ æ–‡ä»¶ï¼‰
cd /var/www/french-ai
# git clone https://github.com/SeleneGallagher/French-AI-Learning-Hub.git .

# 4. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pip install flask flask-cors gunicorn python-dotenv

# 5. é…ç½®Nginxï¼ˆéœ€è¦æ‰‹åŠ¨ç¼–è¾‘ï¼‰
echo "è¯·æ‰‹åŠ¨é…ç½®Nginxå’ŒSystemdæœåŠ¡"
echo "å‚è€ƒéƒ¨ç½²æŒ‡å—å®Œæˆå‰©ä½™æ­¥éª¤"

echo "éƒ¨ç½²å®Œæˆï¼"
```

---

## ğŸ“Š æˆæœ¬ä¼°ç®—

### é˜¿é‡Œäº‘/è…¾è®¯äº‘

- **è½»é‡åº”ç”¨æœåŠ¡å™¨**ï¼šçº¦50-100å…ƒ/æœˆï¼ˆ2æ ¸2GBï¼‰
- **ECSäº‘æœåŠ¡å™¨**ï¼šçº¦100-200å…ƒ/æœˆï¼ˆ2æ ¸4GBï¼‰
- **RDSæ•°æ®åº“**ï¼ˆå¯é€‰ï¼‰ï¼šçº¦50-100å…ƒ/æœˆ

### æ€»æˆæœ¬

- **æœ€ä½é…ç½®**ï¼šçº¦50-100å…ƒ/æœˆ
- **æ¨èé…ç½®**ï¼šçº¦150-300å…ƒ/æœˆ

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨å·²å‡†å¤‡ï¼ˆUbuntu 22.04ï¼‰
- [ ] Python 3.10+ å·²å®‰è£…
- [ ] Nginx å·²å®‰è£…å¹¶é…ç½®
- [ ] é¡¹ç›®æ–‡ä»¶å·²ä¸Šä¼ 
- [ ] Pythonè™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º
- [ ] ä¾èµ–å·²å®‰è£…
- [ ] Flaskåº”ç”¨å·²åˆ›å»ºï¼ˆapp.pyï¼‰
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆ.envï¼‰
- [ ] SystemdæœåŠ¡å·²é…ç½®
- [ ] Nginxé…ç½®å·²å¯ç”¨
- [ ] æœåŠ¡å·²å¯åŠ¨
- [ ] é˜²ç«å¢™å·²å¼€æ”¾80/443ç«¯å£
- [ ] SSLè¯ä¹¦å·²é…ç½®ï¼ˆå¯é€‰ï¼‰

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. 502 Bad Gateway

**åŸå› **ï¼šåç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£ä¸å¯¹

**è§£å†³**ï¼š
```bash
sudo systemctl status french-ai
sudo journalctl -u french-ai -n 50
```

### 2. é™æ€æ–‡ä»¶404

**åŸå› **ï¼šNginxé…ç½®è·¯å¾„é”™è¯¯

**è§£å†³**ï¼šæ£€æŸ¥ `root` è·¯å¾„æ˜¯å¦æ­£ç¡®

### 3. APIè¯·æ±‚å¤±è´¥

**åŸå› **ï¼šCORSæˆ–ä»£ç†é…ç½®é—®é¢˜

**è§£å†³**ï¼šæ£€æŸ¥Nginxçš„ `/api/` ä»£ç†é…ç½®

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡å™¨æ—¥å¿—ï¼š`sudo journalctl -u french-ai -f`
2. Nginxæ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/error.log`
3. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

---

## ğŸ‰ å®Œæˆï¼

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ä½ çš„æœåŠ¡å™¨IPæˆ–åŸŸåå³å¯ä½¿ç”¨ï¼

**ä¼˜åŠ¿**ï¼š
- âœ… å›½å†…è®¿é—®é€Ÿåº¦å¿«
- âœ… æ— éœ€VPN
- âœ… å®Œå…¨æ§åˆ¶æœåŠ¡å™¨
- âœ… å¯ä»¥è‡ªå®šä¹‰é…ç½®

