# 📋 环境变量完整清单

> **⚠️ 重要更新**：项目已移除 Supabase 依赖，不再需要 Supabase 相关环境变量。所有数据使用本地存储（localStorage/IndexedDB）。

本文档列出项目中使用的所有环境变量及其详细说明。

---

## 🟡 可选的环境变量

这些变量是可选的，根据功能需求设置。

### 1. `JWT_SECRET`

**用途**：JWT Token 签名密钥（目前未使用，保留以备将来需要认证功能）

**使用位置**：
- `lib/utils.py` - JWT Token 验证（目前未使用）

**默认值**：`'your-secret-key-change-this'`

**生成方式**：

**Linux/Mac:**
```bash
openssl rand -hex 32
```

**Windows (PowerShell):**
```powershell
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 32 | ForEach-Object {[char]$_})
```

**Python:**
```python
import secrets
secrets.token_hex(32)
```

**示例值**：
```
JWT_SECRET=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
```

---

### 2. `COZE_BOT_ID`

**用途**：Coze 平台机器人 ID，用于 AI 助手功能

**使用位置**：
- `api/ai/coze.py` - 调用 Coze API

**获取方式**：
1. 访问 https://www.coze.cn
2. 登录并创建机器人
3. 在机器人设置中找到 **Bot ID**

**示例值**：
```
COZE_BOT_ID=7583654054706855978
```

**功能影响**：
- 不设置：AI 助手功能不可用
- 设置后：可以使用 Coze AI 助手进行对话

---

### 3. `COZE_PAT_TOKEN`

**用途**：Coze 平台访问令牌（PAT - Personal Access Token）

**使用位置**：
- `api/ai/coze.py` - 调用 Coze API 的认证

**获取方式**：
1. 访问 https://www.coze.cn
2. 进入 **开发者设置** 或 **API 设置**
3. 创建 Personal Access Token (PAT)

**示例值**：
```
COZE_PAT_TOKEN=pat_T8I4bVN3QYKU91S6QuEfycMpMK6PICQbX3TQL3QQJayLuGb4AErkssKnpXaTBCyq
```

**备选变量**：
- `COZE_SAT_TOKEN` - 如果使用 SAT Token 而不是 PAT Token

**功能影响**：
- 不设置：AI 助手功能不可用
- 设置后：可以使用 Coze AI 助手

---

### 4. `COZE_SAT_TOKEN`

**用途**：Coze 平台访问令牌（SAT - System Access Token），作为 `COZE_PAT_TOKEN` 的备选

**使用位置**：
- `api/ai/coze.py` - 如果 `COZE_PAT_TOKEN` 未设置，会尝试使用此变量

**说明**：
- 与 `COZE_PAT_TOKEN` 二选一即可
- 代码逻辑：`COZE_PAT_TOKEN or COZE_SAT_TOKEN`

**示例值**：
```
COZE_SAT_TOKEN=sat_49JcJ2I8HtMXmfyRwjGUDT3Qm82dhwdXttUuSfeORrQCxFmWzjMolKIi6aaE9hfU
```

---

### 5. `DEEPSEEK_API_KEY`

**用途**：DeepSeek API 密钥，用于新闻关键词生成、语用表达生成等功能

**使用位置**：
- `api/ai/deepseek.py` - 调用 DeepSeek API
- `api/config.py` - 检查是否配置

**获取方式**：
1. 访问 https://platform.deepseek.com/api_keys
2. 登录账号
3. 创建新的 API Key

**示例值**：
```
DEEPSEEK_API_KEY=sk-deb6e36e2e8240f4833a97addf42f548
```

**功能影响**：
- 不设置：新闻关键词提取、语用表达生成等功能不可用
- 设置后：可以使用 DeepSeek AI 功能

---

### 6. `TMDB_API_KEY`

**用途**：The Movie Database (TMDB) API 密钥，用于获取电影数据和海报

**使用位置**：
- `api/movies/list.py` - 获取电影列表和详情
- `scripts/server/update_data.py` - 更新电影数据
- `api/config.py` - 检查是否配置

**获取方式**：
1. 访问 https://www.themoviedb.org
2. 注册账号
3. 进入 **Settings** → **API**
4. 申请 API Key（免费）

**示例值**：
```
TMDB_API_KEY=0caa27e2637f5f44948774e9f234dd38
```

**功能影响**：
- 不设置：电影模块会使用占位图和 AI 生成的描述
- 设置后：可以获取真实的电影海报、评分、简介等信息

---

## 📊 环境变量汇总表

| 变量名 | 必需 | 默认值 | 用途 | 获取位置 |
|--------|------|--------|------|----------|
| `JWT_SECRET` | ❌ | `'your-secret-key-change-this'` | JWT 签名密钥（目前未使用） | 自行生成 |
| `COZE_BOT_ID` | ❌ | 无 | Coze 机器人 ID | Coze 平台 → 机器人设置 |
| `COZE_PAT_TOKEN` | ❌ | 无 | Coze 访问令牌 | Coze 平台 → 开发者设置 |
| `COZE_SAT_TOKEN` | ❌ | 无 | Coze 系统令牌（备选） | Coze 平台 |
| `DEEPSEEK_API_KEY` | ❌ | 无 | DeepSeek API 密钥 | https://platform.deepseek.com/api_keys |
| `TMDB_API_KEY` | ❌ | 无 | TMDB API 密钥 | https://www.themoviedb.org/settings/api |

---

## 🚀 在 Railway 中设置环境变量

### 方法一：Railway Dashboard

1. 进入项目页面
2. 点击 **Variables** 标签
3. 点击 **New Variable**
4. 输入变量名和值
5. 点击 **Add**

### 方法二：Railway CLI

```bash
# 设置单个变量
railway variables set COZE_BOT_ID=7583654054706855978
railway variables set COZE_PAT_TOKEN=your-token
railway variables set DEEPSEEK_API_KEY=your-key
railway variables set TMDB_API_KEY=your-key

# 从 .env 文件导入（推荐）
railway variables --file .env
```

### 方法三：创建 .env 文件（本地开发）

在项目根目录创建 `.env` 文件：

```env
# 可选变量
JWT_SECRET=your-generated-secret-key
COZE_BOT_ID=your-bot-id
COZE_PAT_TOKEN=your-pat-token
COZE_SAT_TOKEN=your-sat-token
DEEPSEEK_API_KEY=your-deepseek-key
TMDB_API_KEY=your-tmdb-key
```

**⚠️ 注意**：`.env` 文件已在 `.gitignore` 中，不会被提交到 Git。

---

## ✅ 环境变量检查清单

部署前请确认（所有都是可选的）：

- [ ] `JWT_SECRET` 已设置（如果将来需要认证功能）
- [ ] `COZE_BOT_ID` 和 `COZE_PAT_TOKEN` 已设置（如果需要 AI 助手）
- [ ] `DEEPSEEK_API_KEY` 已设置（如果需要 DeepSeek 功能）
- [ ] `TMDB_API_KEY` 已设置（如果需要电影数据）

---

## 🧪 测试环境变量配置

### 检查后端配置

访问 `/api/config` 端点，查看哪些服务已配置：

```bash
curl https://your-domain.com/api/config
```

返回示例：
```json
{
  "coze": {
    "bot_id": "7583654054706855978",
    "api_base": "https://api.coze.cn/v3",
    "has_token": true
  },
  "tmdb": {
    "has_key": true
  },
  "deepseek": {
    "has_key": true
  }
}
```

---

## 🔒 安全建议

1. **不要提交敏感信息**
   - 确保 `.env` 在 `.gitignore` 中
   - 不要在代码中硬编码密钥

2. **使用强密钥**
   - `JWT_SECRET` 必须使用强随机字符串
   - 不要使用默认值

3. **定期轮换密钥**
   - 定期更新 API 密钥
   - 如果密钥泄露，立即更换

4. **最小权限原则**
   - 只设置需要的环境变量
   - 使用最小必要权限的 API Key

---

## 📚 相关文档

- [移除 Supabase 说明](./移除Supabase说明.md)
- [Railway 部署指南](./Railway部署指南.md)
- [部署方案总览](./部署方案.md)

---

**最后更新**：2024-12-19
